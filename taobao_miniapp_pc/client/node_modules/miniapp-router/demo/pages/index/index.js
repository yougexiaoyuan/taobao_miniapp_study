import routerInit from '/miniapp-router/router';
import routerConfig from './router';

Page({
  data: {
    currentTarget: routerConfig.option.initPath,
    param: '',
  },
  onLoad() {
    routerInit.call(this, routerConfig);
    this.$router.setBeforeChange(this, 'onBeforeChange');
    this.$router.setAfterChange(this, 'onAfterChange');
    this.$router.addParamsListener(this, 'onParamsChange');
    console.log('$router', this.__routerInstance);

  },
  tapHandle(e) {
    let {
      currentTarget: { dataset },
    } = e;
    if (dataset.type == 'replace') {
      this.$router.replace(dataset.url);
      return;
    }
    this.$router.push(dataset.url);
  },
  onBeforeChange(from, to) {
    this.setData({ currentTarget: to });
    return true;
  },
  onParamsChange(preParams, nextParams) {
    //钩子函数可以获取两个参数，preParams为之前的params，
    //nextParams为变化后的params
    this.setData({ param: JSON.stringify(nextParams) });
  },
  onAfterChange() {
    console.log('onAfterChange', this.__routerInstance)
  }
});
